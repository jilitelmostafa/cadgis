<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CartoMaroc Provinces</title>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@v7.4.0/ol.css">
<script src="https://cdn.jsdelivr.net/npm/ol@v7.4.0/dist/ol.js"></script>

<style>
html, body { margin:0; padding:0; height:100%; overflow:hidden; font-family: Arial, sans-serif;}
#app {height:100vh; display:flex; flex-direction:column;}
#header {flex-shrink:0; background: linear-gradient(135deg, #E49112 0%, #1B5B9A 100%); color:white; text-align:center; padding:12px 10px; font-size:clamp(14px,4vw,22px); font-weight:bold; box-shadow:0 4px 6px rgba(0,0,0,0.1);}
#content {position:relative; flex:1; overflow:hidden;}
#map {position:absolute; inset:0; width:100%; height:100%;}

#watermark {position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); font-size:clamp(18px,5vw,32px); font-weight:bold; color:rgba(102,126,234,0.15); pointer-events:none; z-index:1500; white-space:nowrap; text-shadow:2px 2px 4px rgba(255,255,255,0.3);}

.ol-popup {background:linear-gradient(135deg, #ffffff 0%, #f5f7fb 100%); padding:14px 16px; border:1px solid #e0e4ef; min-width:200px; max-width:90vw; z-index:9999; font-size:13px; border-radius:10px; box-shadow:0 10px 25px rgba(15,23,42,0.18); color:#1f2933;}
.ol-popup b {font-size:14px; color:#111827;}
.ol-popup a, .ol-popup button {display:inline-block; margin-top:6px; padding:6px 10px; background:#dc2626; color:#fff; border:none; border-radius:6px; text-decoration:none; font-size:12px; cursor:pointer; margin-right:5px;}
.ol-popup a:hover, .ol-popup button:hover {background:#b91c1c;}
.ol-popup .request-btn {background:#9333ea;}
.ol-popup .request-btn:hover {background:#7e22ce;}
.ol-popup .download-btn {background:#4CAF50;}
.ol-popup .download-btn:hover {background:#388E3C;}

#legend {position:absolute; top:400px; right:10px; background:rgba(255,255,255,0.96); padding:10px 12px; border-radius:10px; box-shadow:0 4px 12px rgba(15,23,42,0.25); z-index:3000; font-size:11px; min-width:135px; max-width:45vw; border:1px solid rgba(148,163,184,0.7); backdrop-filter:blur(4px);}
.legend-item {display:flex; align-items:center; gap:6px; margin-bottom:6px;}
.legend-item:last-child {margin-bottom:0;}
.legend-color {width:16px; height:16px; border:1px solid #000; flex-shrink:0;}

/* ÿ®ÿ≠ÿ´ OSM ŸÖŸÅÿ™Ÿàÿ≠ ÿØÿßÿ¶ŸÖŸãÿß ŸÖÿπ ÿ•ÿ∫ŸÑÿßŸÇ */
#searchContainer {
  position:absolute;
  top:10px; right:10px;
  z-index:2000;
  display:flex;
  flex-direction:column;
}
#searchBoxOSM {
  width:220px;
  padding:6px 10px;
  font-size:13px;
  border-radius:20px;
  border:1px solid #ccc;
  outline:none;
}
#searchBoxOSM:focus {border-color:#2563eb;}
#closeSearch {
  position:absolute;
  top:6px; right:5px;
  font-size:12px;
  cursor:pointer;
  color:#555;
  user-select:none;
}
#showSearchSmall {
  display:none;
  position:absolute;
  top:10px; right:10px;
  z-index:2000;
  font-size:16px;
  cursor:pointer;
  background:#2563eb;
  color:#fff;
  border-radius:50%;
  width:28px; height:28px;
  display:flex; align-items:center; justify-content:center;
}
#suggestions {
  margin-top:2px;
  width:220px;
  max-height:150px;
  overflow-y:auto;
  padding:0;
  list-style:none;
  border:1px solid #ccc;
  background:#fff;
  border-radius:6px;
  display:block;
  font-size:13px;
}
#suggestions li {padding:6px 10px; cursor:pointer;}
#suggestions li:hover {background:#f0f0f0;}
@media (max-width:768px){
  #searchBoxOSM, #suggestions {width:160px;}
}

/* ÿ≤ÿ± ÿ™ÿ®ÿØŸäŸÑ ÿßŸÑÿÆŸÑŸÅŸäÿßÿ™ ŸÅŸä ÿßŸÑŸäŸÖŸäŸÜ ÿßŸÑÿπŸÑŸàŸä (ŸÇÿ®ŸÑ ÿßŸÑÿ®ÿ≠ÿ´ ÿ®ŸÇŸÑŸäŸÑ) */
#basemapToggle {
  position:absolute;
  top:10px;
  right:250px; /* ÿ≠ÿ™Ÿâ ŸÑÿß Ÿäÿ™ÿØÿßÿÆŸÑ ŸÖÿπ ÿßŸÑÿ®ÿ≠ÿ´ */
  z-index:2100;
  padding:6px 10px;
  font-size:12px;
  border-radius:6px;
  border:none;
  background:#2563eb;
  color:#fff;
  cursor:pointer;
}
#basemapToggle:hover { background:#1d4ed8; }
</style>
</head>
<body>

<div id="app">
<header id="header">
CadGIS | Titres fonciers  | Bornes  | Zonage | Limites ADM
</header>

<main id="content">
<div id="map">
  <div id="watermark">@CartoMaroc</div>
</div>

<!-- ÿ≤ÿ± ÿ™ÿ®ÿØŸäŸÑ ÿßŸÑÿÆŸÑŸÅŸäÿ© -->
<button id="basemapToggle">üó∫Ô∏è OSM</button>

<!-- ŸÖÿ±ÿ®ÿπ ÿßŸÑÿ®ÿ≠ÿ´ ÿßŸÑŸÉÿßŸÖŸÑ -->
<div id="searchContainer">
  <input type="text" id="searchBoxOSM" placeholder="üîç Rechercher...">
  <span id="closeSearch">üóô</span>
  <ul id="suggestions"></ul>
</div>

<!-- ÿ£ŸäŸÇŸàŸÜÿ© ŸÑÿ•ÿπÿßÿØÿ© ŸÅÿ™ÿ≠ ÿßŸÑÿ®ÿ≠ÿ´ -->
<div id="showSearchSmall">üîç</div>

<div id="popup" class="ol-popup"></div>

<script>
document.addEventListener("DOMContentLoaded", function(){

const geojsonSource = new ol.source.Vector({
  url:"https://ia601703.us.archive.org/6/items/prov_ma_202601/prov_ma.txt",
  format: new ol.format.GeoJSON()
});

function getProvinceName(feature){
  const props = feature.getProperties();
  const possible=["NOM-PROV","NOM_PROV","name","NAME","nom","Nom","ÿßŸÑÿßŸÇŸÑŸäŸÖ","ÿßŸÑÿ•ŸÇŸÑŸäŸÖ"];
  for(let f of possible) if(props[f]) return props[f];
  return "Sans nom";
}

const geojsonLayer = new ol.layer.Vector({
  source:geojsonSource,
  style:function(feature){
    const fillColor = "rgba(244, 67, 54, 0.1)";
    return new ol.style.Style({
      stroke:new ol.style.Stroke({color:"black", width:1.3}),
      fill:new ol.style.Fill({color:fillColor}),
      text:new ol.style.Text({
        text:getProvinceName(feature),
        font:"bold 12px Arial",
        fill:new ol.style.Fill({color:"#000"}),
        stroke:new ol.style.Stroke({color:"#fff", width:2})
      })
    });
  }
});

/* ÿ´ŸÑÿßÿ´ ÿÆŸÑŸÅŸäÿßÿ™: OSM, Esri, Sat */
const osmStandard = new ol.layer.Tile({
  source:new ol.source.OSM(),
  visible:true
});

const esriImagery = new ol.layer.Tile({
  source:new ol.source.XYZ({
    url:'https://server.arcgisonline.com/ArcGIS/rest/services/' +
        'World_Imagery/MapServer/tile/{z}/{y}/{x}'
  }),
  visible:false
});

const satLike = new ol.layer.Tile({
  source:new ol.source.XYZ({
    url:'https://tile.openstreetmap.fr/hot/{z}/{x}/{y}.png'
  }),
  visible:false
});

const map=new ol.Map({
  target:"map",
  layers:[
    osmStandard,
    esriImagery,
    satLike,
    geojsonLayer
  ],
  view:new ol.View({
    center:ol.proj.fromLonLat([-7.9,31.6]),
    zoom:6
  })
});

/* ÿ™ŸÑŸàŸäŸÜ ÿ£ÿµŸÅÿ± ÿπŸÜÿØ ÿßŸÑÿ™ÿ≠ÿØŸäÿØ */
const selectInteraction = new ol.interaction.Select({
  layers: [geojsonLayer],
  style: function(feature){
    return new ol.style.Style({
      stroke: new ol.style.Stroke({
        color: "#facc15",
        width: 2.5
      }),
      fill: new ol.style.Fill({
        color: "rgba(250, 204, 21, 0.45)"
      }),
      text: new ol.style.Text({
        text: getProvinceName(feature),
        font:"bold 12px Arial",
        fill:new ol.style.Fill({color:"#000"}),
        stroke:new ol.style.Stroke({color:"#fff", width:2})
      })
    });
  }
});
map.addInteraction(selectInteraction);

const popup=new ol.Overlay({
  element:document.getElementById("popup"),
  positioning:"bottom-center",
  offset:[0,-15]
});
map.addOverlay(popup);

const provinceDownloadLinks = {
  "OUAD EDDAHAB":"https://drive.google.com/file/d/1W8TCjsJgGSjER0IZ8-oAd6YYIMAZzmul/view?usp=drivesdk",
  "AOUSSERD":"https://drive.google.com/file/d/1q__rToOcK8IiQoiuiCSjFYXOTTGA_NzJ/view?usp=drive_link",
  "BOUJDOUR":"https://drive.google.com/file/d/1q__rToOcK8IiQoiuiCSjFYXOTTGA_NzJ/view?usp=drive_link",
  "LAAYOUNE":"https://drive.google.com/file/d/1skAk7DnHMT8KbdckQueH7Vt8OB1RcwUy/view?usp=drivesdk",
  "TRAFAYA":"https://drive.google.com/file/d/1q__rToOcK8IiQoiuiCSjFYXOTTGA_NzJ/view?usp=drive_link",
  "ESSMARA":"https://drive.google.com/file/d/1rjAx7oPAKQ00teooftXITob8yT-Qpruf/view?usp=drivesdk",
  "CHTOUKA AIT BAHA":"https://drive.google.com/file/d/16H78YAucHZ2dmHBlQoEYAZjyTOeRKxrn/view?usp=drivesdk",
  "TAROUDANNT":"https://drive.google.com/file/d/1xkm_jDhqofnXlYJwMFtXJvnotQNplNSw/view?usp=drivesdk",
  "TIZNIT":"https://drive.google.com/file/d/1fhYvVKrfxseEfJYmFjNQIzxQaglz825M/view?usp=drivesdk",
  "TATA":"https://drive.google.com/file/d/1q__rToOcK8IiQoiuiCSjFYXOTTGA_NzJ/view?usp=drive_link",
  "AGADIR IDA OU TANANE":"https://drive.google.com/file/d/1UWDokzDiJuNO6_vqc590B87iEF9_IcTK/view?usp=drivesdk",
  "INEZEGANE AIT MELLOUL":"https://drive.google.com/file/d/1yyd-GQF5BVfF4SrYlwGPEkr7ucxYhiql/view?usp=drivesdk",
  "TINGHIR":"https://drive.google.com/file/d/1q__rToOcK8IiQoiuiCSjFYXOTTGA_NzJ/view?usp=drive_link",
  "OURZAZTE":"https://drive.google.com/file/d/1pUAIzQBujnLogFnYkx6Tyjj_bn7nS_7N/view?usp=drivesdk",
  "ZAGORA":"https://drive.google.com/file/d/1q__rToOcK8IiQoiuiCSjFYXOTTGA_NzJ/view?usp=drive_link",
  "MIDELT":"https://drive.google.com/file/d/1XBBoFWEYrWED6bpn0Cjv_gKOEaLqgacF/view?usp=drivesdk",
  "ERRACHIDIA":"https://drive.google.com/file/d/1CQUSWjOngEjJ0wqb5KCyYZM6IwyvN5bN/view?usp=drivesdk",
  "SAFI":"https://drive.google.com/file/d/1VdWIMs5G0wHg7KxqvW8ZzXhVRc3T1ios/view?usp=drivesdk",
  "ESSAOUIRA":"https://drive.google.com/file/d/1L_t0wJAVCE9ARPZqIj0oO0zs5WvGz-Tr/view?usp=drivesdk",
  "CHICHAOUA":"https://drive.google.com/file/d/1dcpUuDW09LVUXAH8adSFGArqpI8xGthu/view?usp=drivesdk",
  "AL HAOUZ":"https://drive.google.com/file/d/1L1oXEZxemYHwawUMOJRr2ge5rUDRrXuE/view?usp=drivesdk",
  "EL KELAA DES SRAGHNA":"https://drive.google.com/file/d/1q__rToOcK8IiQoiuiCSjFYXOTTGA_NzJ/view?usp=drive_link",
  "REHAMNA":"https://drive.google.com/file/d/1q__rToOcK8IiQoiuiCSjFYXOTTGA_NzJ/view?usp=drive_link",
  "MARRAKECH":"https://drive.google.com/file/d/1L1oXEZxemYHwawUMOJRr2ge5rUDRrXuE/view?usp=drivesdk",
  "YOUSSOUFIA":"https://drive.google.com/file/d/16pejhEpwbKjxDxOiMCalhAkDPKRPcVGa/view?usp=drivesdk",
  "SETTAT":"https://drive.google.com/file/d/1Rm37o7-ybmDhlLAJWg2-LUVoH0ZxqIx7/view?usp=drivesdk",
  "SIDI BENNOUR":"https://drive.google.com/file/d/1eLfmImakIX_B2h0KNBCYrx3LF8H0Mm--/view?usp=drivesdk",
  "BEN SLIMANE":"https://drive.google.com/file/d/1Rlk-Lhw7oDB5EPT6vpG1cd-g1D5rOQYS/view?usp=drivesdk",
  "BERCHID":"https://drive.google.com/file/d/1urqgs3lWp_6bKJkded0vET9UI5rS2brY/view?usp=drivesdk",
  "M√âDIOUNA":"https://drive.google.com/file/d/1rjAx7oPAKQ00teooftXITob8yT-Qpruf/view?usp=drivesdk",
  "MOHAMMEDIA":"https://drive.google.com/file/d/1Nz8_GFQNNw_4FEgXeTHTcubYd1oxMKyt/view?usp=drivesdk",
  "EL JADIDA":"https://drive.google.com/file/d/1s04RDcVBgGizNhdbg4Sz_ZY36twLx0hS/view?usp=drivesdk",
  "CASABLANCA":"https://drive.google.com/file/d/19dK56HuNRDSxyaXPbBGA7bpaZkEo5bIq/view?usp=drivesdk",
  "NOUACER":"https://drive.google.com/file/d/1ZTRHOun341z907E2ncXxrxjJgDd--E83/view?usp=drivesdk",
  "AZILAL":"https://drive.google.com/file/d/1yf752JHPOL8o8ol8bZv3_orPaqIpD60t/view?usp=drivesdk",
  "KHENIFRA":"https://drive.google.com/file/d/1ROc0iqfuE_koHagIEjtORQA9jyyhrBsD/view?usp=drivesdk",
  "KHOURIBGA":"https://drive.google.com/file/d/1V-nlu6qBQIBwhCqT-yV7pHOJK_8z3AyZ/view?usp=drivesdk",
  "BENI MELLAL":"https://drive.google.com/file/d/1anC3cMqAJrhrjhZ21NPK8CnMuJcWLHOu/view?usp=drivesdk",
  "FQUIH BEN SALAH":"https://drive.google.com/file/d/1rjAx7oPAKQ00teooftXITob8yT-Qpruf/view?usp=drivesdk",
  "SAL√â":"https://drive.google.com/file/d/1Ky7LBN5aLnkTZwdC3PWYfT6nC4ci98Qr/view?usp=drivesdk",
  "KHEMISSET":"https://drive.google.com/file/d/1d5IUnW_2pAhg64VUqCmf3dk8fr9fG6d_/view?usp=drivesdk",
  "SIDI KACEM":"https://drive.google.com/file/d/1-exZqMZPQ62H4X3PH5iFoiic1XzSvDXv/view?usp=drivesdk",
  "SIDI SLIMANE":"https://drive.google.com/file/d/1Zg_ZHhCCm11UG740ntFhOojgK3Qn6ZZF/view?usp=drivesdk",
  "K√âNITRA":"https://drive.google.com/file/d/1fhdAWLXrNEcGR42QRX6b8q9zh3BfP2Ry/view?usp=drivesdk",
  "SKHIRATE- TEMARA":"https://drive.google.com/file/d/106K0yigp55ZDAGNQY_XVVY5WmZ-bAEJH/view?usp=drivesdk",
  "RABAT":"https://drive.google.com/file/d/13QhQIUO1ItLQi133fQ8p2yxHsEdw0oVn/view?usp=drivesdk",
  "EL HAJEB":"https://drive.google.com/file/d/1BS7zD6tcsHBTIc8_GRnPWHN06veAOavG/view?usp=drivesdk",
  "TAZA":"https://drive.google.com/file/d/1t2o1j6mwy2BW9mkfCVzOFTS-KQhr3w4H/view?usp=drivesdk",
  "F√àS":"https://drive.google.com/file/d/1a6QUwgao4okjcyR1V_Hz3BAWZVeo-MS5/view?usp=drivesdk",
  "BOULEMANE":"https://drive.google.com/file/d/1MO94Ql8RAyZaRSVW6R5uhA5wlvaA3q1L/view?usp=drivesdk",
  "MEKNES":"https://drive.google.com/file/d/1a8GSI4_0a6L1hgkaAO0LrJBZ4X0fa6K4/view?usp=drivesdk",
  "MOULAY YACOUB":"https://drive.google.com/file/d/1q__rToOcK8IiQoiuiCSjFYXOTTGA_NzJ/view?usp=drive_link",
  "SEFROU":"https://drive.google.com/file/d/1ppx8GAqzlTGkrfG9aqX3GDkSt2m6tpJg/view?usp=drivesdk",
  "TAOUNATE":"https://drive.google.com/file/d/1nTYogtuaLXvMO6LGNkplVDIB8AGKsNrl/view?usp=drivesdk",
  "IFRANE":"https://drive.google.com/file/d/1c1w2yGvR3cahFsSbCSt7kD2maEkedhr7/view?usp=drivesdk",
  "GUERSSIF":"https://drive.google.com/file/d/1X-Z6WjtJUp7Zj-ggm9PvWJZiE_DlP0AZ/view?usp=drivesdk",
  "DRIOUCH":"https://drive.google.com/file/d/1YfXPI41zaqDRkX0LVMtdQyGlzD65ZWi-/view?usp=drivesdk",
  "FIGUIG":"https://drive.google.com/file/d/1wanlzg6Fa9G_Wi6818LwpNn1kNTJntJm/view?usp=drivesdk",
  "JRADA":"https://drive.google.com/file/d/1V-iz009XJ2IaQOZVcAK0vdPRqbIY4Czj/view?usp=drivesdk",
  "OUJDA - ANGAD":"https://drive.google.com/file/d/1G1P-MyrpQFederk_zbkBAr8MUoynV6Lj/view?usp=drivesdk",
  "TAOURIRT":"https://drive.google.com/file/d/14YVjpHq26bcoIjSO-VoKTVNhgzxBQdNY/view?usp=drivesdk",
  "BERKANE":"https://drive.google.com/file/d/1sv-PSyXqi5uSg-ddUoUBJ9rh2096_OPW/view?usp=drivesdk",
  "NADOR":"https://drive.google.com/file/d/1wanlzg6Fa9G_Wi6818LwpNn1kNTJntJm/view?usp=drivesdk",
  "OUAZZANE":"https://drive.google.com/file/d/1t2o1j6mwy2BW9mkfCVzOFTS-KQhr3w4H/view?usp=drivesdk",
  "EL FAHS - ANGRA":"https://drive.google.com/file/d/1q__rToOcK8IiQoiuiCSjFYXOTTGA_NzJ/view?usp=drive_link",
  "TANGER - ASILAH":"https://drive.google.com/file/d/1YlidcDUw3SPD7FeNnignFL7TesbRaxp3/view?usp=drivesdk",
  "CHEFCHAOUEN":"https://drive.google.com/file/d/1yyd-GQF5BVfF4SrYlwGPEkr7ucxYhiql/view?usp=drivesdk",
  "LARACHE":"https://drive.google.com/file/d/1BVFiiO3aRAGQRAOws-wZyeZoMBfveQS2/view?usp=drivesdk",
  "TETOUAN":"https://drive.google.com/file/d/1ykxVLBOxAwNM5H61uMDdh2b05v5ftgku/view?usp=drivesdk",
  "M'DIQ-FNIDEQ":"https://drive.google.com/file/d/16UBnn2PPiHhBYEpQCNPRL29tdv98zX7T/view?usp=drivesdk",
  "AL HOUCEIMA":"https://drive.google.com/file/d/1YfXPI41zaqDRkX0LVMtdQyGlzD65ZWi-/view?usp=drivesdk",
  "ASSA - ZAG":"https://drive.google.com/file/d/1q__rToOcK8IiQoiuiCSjFYXOTTGA_NzJ/view?usp=drive_link",
  "GUELMIM":"https://drive.google.com/file/d/1nXiPzn8Q-wXaJvoy7m7gEBZNzlY-WKc1/view?usp=drivesdk",
  "SIDI  IFNI":"https://drive.google.com/file/d/1q__rToOcK8IiQoiuiCSjFYXOTTGA_NzJ/view?usp=drive_link",
  "TAN - TAN":"https://drive.google.com/file/d/1q__rToOcK8IiQoiuiCSjFYXOTTGA_NzJ/view?usp=drive_link"
};

window.downloadProvinceData=function(provinceName){
  const link=provinceDownloadLinks[provinceName];
  if(link) window.open(link,"_blank");
  else alert("‚ö†Ô∏è ÿ±ÿßÿ®ÿ∑ ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ ÿ∫Ÿäÿ± ŸÖÿ™ŸàŸÅÿ± ŸÑŸáÿ∞ÿß ÿßŸÑÿ•ŸÇŸÑŸäŸÖ");
};

window.contactWhatsApp=function(provinceName){
  const frenchMessage=`Bonjour, je souhaite recevoir la base de donn√©es compl√®te des Titres, Bornes et Limites pour (*${provinceName}*). Merci !`;
  const arabicMessage=`\nŸÖÿ±ÿ≠ÿ®Ÿãÿßÿå ÿ£ŸàÿØ ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ŸÇÿßÿπÿØÿ© ÿßŸÑŸÖÿπÿ∑Ÿäÿßÿ™ ÿßŸÑŸÉÿßŸÖŸÑÿ© ÿßŸÑÿÆÿßÿµÿ© ÿ®ŸÄ:\n(*${provinceName}*)`;
  const message=frenchMessage+arabicMessage;
  const whatsappURL=`https://wa.me/212668090285?text=${encodeURIComponent(message)}`;
  window.open(whatsappURL,"_blank");
};

/* ===== popup ŸÖÿπ ÿßÿ≥ŸÖ ŸÅÿ±ŸÜÿ≥Ÿä Ÿàÿπÿ±ÿ®Ÿä ===== */
function showPopup(feature, coord){
  const nomFr = feature.get('NOM_PROV') || getProvinceName(feature);
  const nomAr = feature.get('nomArabic') || '';

  let html = `
    <b>${nomFr}</b><br>
    <span style="font-weight:bold; color:#FF0000;">
      Titres fonciers | Bornes | Zonage | ${nomAr}
    </span><br>
     ‚ÑπÔ∏è Donn√©es disponibles sur demande
<br>


  `;

  html += `
    <button class="request-btn" onclick="downloadProvinceData('${nomFr}')">
      üì± Demander ces donn√©es
    </button><br>
  `;

  html += `
    <button class="download-btn" onclick="contactWhatsApp('${nomFr}')">
      üìû Contacter via WhatsApp
    </button>  <br>
    Email: <a href="mailto:contact@cartomaroc.com">contact@cartomaroc.com</a>
  `;


  popup.getElement().innerHTML=html;
  popup.setPosition(coord);

  
}

map.on("click",(evt)=>{
  const f=map.forEachFeatureAtPixel(evt.pixel,ft=>ft);
  if(f) showPopup(f,evt.coordinate);
  else popup.setPosition(undefined);
});

/* ÿßŸÑÿ®ÿ≠ÿ´ OSM ÿßŸÑŸÖŸÅÿ™Ÿàÿ≠ ŸÖÿπ ÿßŸÇÿ™ÿ±ÿßÿ≠ÿßÿ™ */
const searchBox=document.getElementById("searchBoxOSM");
const suggestions=document.getElementById("suggestions");
const closeSearch=document.getElementById("closeSearch");
const showSearchSmall=document.getElementById("showSearchSmall");

searchBox.addEventListener("input",function(){
  const query=this.value.trim();
  if(!query){ suggestions.style.display="none"; return; }

  fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query+', Maroc')}&limit=5`)
    .then(res=>res.json())
    .then(data=>{
      suggestions.innerHTML="";
      if(data.length>0){
        data.forEach(item=>{
          const li=document.createElement("li");
          li.textContent=item.display_name;
          li.addEventListener("click",()=>{
            const lon=parseFloat(item.lon);
            const lat=parseFloat(item.lat);
            map.getView().animate({center:ol.proj.fromLonLat([lon,lat]), zoom:12, duration:1000});
            suggestions.style.display="none";
            searchBox.value=item.display_name;
          });
          suggestions.appendChild(li);
        });
        suggestions.style.display="block";
      } else suggestions.style.display="none";
    }).catch(err=>console.error(err));
});

// ÿ•ÿ∫ŸÑÿßŸÇ ŸÖÿ±ÿ®ÿπ ÿßŸÑÿ®ÿ≠ÿ´ ÿ®ÿßŸÑŸÉÿßŸÖŸÑ Ÿàÿ•ÿ∏Ÿáÿßÿ± ÿßŸÑÿ£ŸäŸÇŸàŸÜÿ© ÿßŸÑÿµÿ∫Ÿäÿ±ÿ©
closeSearch.addEventListener("click",()=>{
  document.getElementById("searchContainer").style.display="none";
  showSearchSmall.style.display="flex";
});

// ÿ•ÿπÿßÿØÿ© ŸÅÿ™ÿ≠ ÿßŸÑÿ®ÿ≠ÿ´ ÿπŸÜÿØ ÿßŸÑŸÜŸÇÿ± ÿπŸÑŸâ ÿßŸÑÿ£ŸäŸÇŸàŸÜÿ© ÿßŸÑÿµÿ∫Ÿäÿ±ÿ©
showSearchSmall.addEventListener("click",()=>{
  document.getElementById("searchContainer").style.display="flex";
  showSearchSmall.style.display="none";
});

document.addEventListener("click",function(e){
  if(e.target!==searchBox) suggestions.style.display="none";
});

/* ÿ™ÿ®ÿØŸäŸÑ ÿ®ŸäŸÜ OSM / Esri / Sat */
const basemapBtn = document.getElementById('basemapToggle');
const basemaps = [
  {layer: osmStandard, label: 'OSM'},
  {layer: esriImagery, label: 'Esri'},
  {layer: satLike,     label: 'Sat'}
];
let currentBase = 0;

function setBasemap(index){
  basemaps.forEach((b,i)=> b.layer.setVisible(i === index));
  basemapBtn.textContent = 'üó∫Ô∏è ' + basemaps[index].label;
}

basemapBtn.addEventListener('click', () => {
  currentBase = (currentBase + 1) % basemaps.length;
  setBasemap(currentBase);
});

// ÿßŸÅÿ™ÿ±ÿßÿ∂Ÿä: OSM
setBasemap(0);

});
</script>

</body>
</html>
